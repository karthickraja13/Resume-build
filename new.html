<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Responsive Resume Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1220;
    --panel:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    --muted:#9aa4b2;
    --accent:#0b6cff;
    --card:#0f1724;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071026, #08101a);color:#e6eef8}
  .app {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: 16px;
    padding: 16px;
    height: calc(100vh - 32px);
  }

  /* responsive: tablet and mobile stack and show smaller preview but keep A4 aspect */
  @media (max-width: 980px) {
    .app { grid-template-columns: 1fr; grid-auto-rows: auto; height: auto; padding-bottom: 32px; }
  }

  .panel {
    background: var(--panel);
    border-radius: 12px;
    padding: 12px;
    overflow:auto;
    border:1px solid rgba(255,255,255,0.03);
    min-height: 200px;
  }
  h1{margin:0;font-size:18px}
  .meta {display:flex;gap:10px;align-items:center}
  .logo {width:44px;height:44px;border-radius:10px;background:var(--accent);display:grid;place-items:center;font-weight:700;color:white}
  label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
  input[type=text], input[type=url], input[type=number], textarea, select, input[type=color]{
    width:100%;padding:9px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:6px;font-size:14px;
  }
  textarea{min-height:64px;resize:vertical}
  .row{display:flex;gap:8px}
  .row .col{flex:1}
  .muted{color:var(--muted);font-size:13px}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:8px;border:none;background:var(--accent);color:#041025;font-weight:700;cursor:pointer;margin-top:8px}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .small{padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent}
  .list{margin-top:12px}
  .item{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;margin-top:8px;border:1px solid rgba(255,255,255,0.02)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  footer{margin-top:12px;color:var(--muted);font-size:13px}

  /* preview area */
  .preview-wrap { display:flex;align-items:center;justify-content:center; }
  .canvas-wrap { width:100%; height:100%; display:flex; align-items:center; justify-content:center; padding:12px; }
  canvas { box-shadow: 0 24px 80px rgba(0,0,0,0.6); border-radius:6px; background: white; }

  /* touch targets */
  button, input, select, textarea { touch-action: manipulation; -webkit-tap-highlight-color: rgba(0,0,0,0); }

  /* Template selector */
  .templates { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
  .tpl { padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); cursor:pointer; background:transparent; color:var(--muted); }
  .tpl.selected { outline:2px solid rgba(11,108,255,0.12); color: white; border-color: rgba(255,255,255,0.06); }

  /* small helper */
  .inline { display:inline-flex; gap:8px; align-items:center; }
</style>
</head>
<body>
  <div class="app">
    <!-- left panel: form -->
    <div class="panel" id="panel">
      <div class="meta">
        <div class="logo">CV</div>
        <div>
          <h1>Resume Builder</h1>
          <div class="muted">Responsive for mobile / tablet / laptop • A4 export</div>
        </div>
      </div>

      <label>Template</label>
      <div class="templates">
        <button class="tpl selected" data-tpl="ats">ATS — Professional</button>
        <button class="tpl" data-tpl="hitech">Hi-Tech Neon</button>
        <button class="tpl" data-tpl="portfolio">Creative Portfolio</button>
      </div>

      <h2 style="margin-top:14px">Profile</h2>
      <label>Photo <input id="photo" type="file" accept="image/*"></label>

      <div class="row">
        <div class="col"><label>Full name <input id="name" type="text"></label></div>
        <div class="col"><label>Headline <input id="headline" type="text"></label></div>
      </div>

      <label>LinkedIn <input id="linkedin" type="url"></label>
      <div class="row">
        <div class="col"><label>Email <input id="email" type="text"></label></div>
        <div class="col"><label>Phone <input id="phone" type="text"></label></div>
      </div>
      <label>Location <input id="location" type="text"></label>
      <label>Summary <textarea id="summary"></textarea></label>

      <h2>Education</h2>
      <div class="row">
        <input id="school" type="text" placeholder="School / University" class="small">
        <input id="degree" type="text" placeholder="Degree" class="small">
      </div>
      <label>Years <input id="eduYears" type="text"></label>
      <label>Relevant Coursework <input id="coursework" type="text"></label>

      <h2>Technical Skills</h2>
      <div id="skillList" class="list"></div>
      <div class="actions">
        <button id="addSkill" class="small">+ Add Skill</button>
        <label style="margin-left:auto">Accent <input id="theme" type="color" value="#0b6cff"></label>
      </div>

      <h2>Experience</h2>
      <div id="expList" class="list"></div>
      <div class="actions">
        <button id="addExp" class="small">+ Add Experience</button>
        <button id="addCo" class="small">+ Add Co-Experience to Last</button>
      </div>

      <h2>Projects / Additional</h2>
      <label>Projects <textarea id="projects"></textarea></label>
      <label>Additional Info <textarea id="additional"></textarea></label>

      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
        <button id="saveLocal" class="btn">Save Locally</button>
        <button id="loadLocal" class="btn ghost">Load Local</button>
        <button id="exportJson" class="btn ghost">Download JSON</button>
        <label class="small ghost" style="display:inline-flex;align-items:center;cursor:pointer;padding:6px 8px">
          <input id="importJson" type="file" accept=".json" style="display:none">Import JSON
        </label>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="downloadPNG" class="btn">Download PNG (A4)</button>
        <button id="downloadPDF" class="btn ghost">Download PDF (A4)</button>
      </div>

      <div style="margin-top:12px">
        <button id="resetBtn" class="small ghost">Reset to Sample</button>
      </div>

      <footer>Preview shows the print layout. On mobile the form stacks above the preview for easy editing.</footer>
    </div>

    <!-- right panel: preview (canvas) -->
    <style type="text/css">
      .preview-wrap {
  display:flex;
  align-items:center;
  justify-content:center;
  position: relative; /* added */
}
    </style>
    <div style="position:absolute; top:16px; right:16px; display:flex; gap:6px; z-index:10;">
  <button id="zoomInBtn" class="small" style="background: blue;">＋</button>
  <button id="zoomOutBtn" class="small" style="background: blue;">－</button>
  <button id="zoomResetBtn" class="small" style="background: blue;">⟳</button>
</div>
<script type="text/javascript">
  let zoomFactor = 1; // 1 = normal size

function applyZoom() {
  const wrap = document.querySelector('.canvas-wrap');
  const ratio = A4_PX_W / A4_PX_H;
  // base size fitting to container
  const maxW = Math.max(300, wrap.clientWidth - 24);
  const maxH = Math.max(420, window.innerHeight - 200);
  let showW = maxW, showH = Math.round(showW / ratio);
  if (showH > maxH) { showH = maxH; showW = Math.round(showH * ratio); }
  // apply zoom
  canvas.style.width = (showW * zoomFactor) + 'px';
  canvas.style.height = (showH * zoomFactor) + 'px';
}

// Hook buttons
document.getElementById('zoomInBtn').addEventListener('click', () => {
  zoomFactor = Math.min(zoomFactor + 0.1, 3); // cap at 3x
  applyZoom();
});
document.getElementById('zoomOutBtn').addEventListener('click', () => {
  zoomFactor = Math.max(zoomFactor - 0.1, 0.5); // cap at 0.5x
  applyZoom();
});
document.getElementById('zoomResetBtn').addEventListener('click', () => {
  zoomFactor = 1;
  applyZoom();
});

// Update zoom on window resize
window.addEventListener('resize', applyZoom);

</script>

    <div class="preview-wrap">
      <div class="canvas-wrap">
        <!-- canvas is sized to A4 at 150 DPI for clean export; CSS will scale it to fit preview area -->
        <canvas id="canvas"></canvas>
      </div>
    </div>
  </div>

  <!-- jsPDF used for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* Responsive ATS-style resume builder
   - Multi-template (ATS default)
   - A4 export (PNG & PDF)
   - Local save/load JSON
   - Responsive layout: form stacks on small screens but preview keeps A4 aspect
*/

// A4 in mm -> convert to px at DPI
const MM_TO_IN = 1/25.4;
const DPI = 150; // export DPI (150 is a good tradeoff)
const A4_MM_W = 210, A4_MM_H = 297;
const A4_PX_W = Math.round(A4_MM_W * MM_TO_IN * DPI);
const A4_PX_H = Math.round(A4_MM_H * MM_TO_IN * DPI);

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// Set canvas physical pixel size for exports
canvas.width = A4_PX_W;
canvas.height = A4_PX_H;

// Scale canvas CSS so preview fits screen but keep aspect ratio
function fitCanvasToContainer(){
  // We want to show the canvas scaled down to fit the preview area while maintaining A4 ratio.
  const wrap = document.querySelector('.canvas-wrap');
  const maxW = Math.max(300, wrap.clientWidth - 24);
  const maxH = Math.max(420, window.innerHeight - 200);
  // A4 ratio
  const ratio = A4_PX_W / A4_PX_H;
  let showW = maxW, showH = Math.round(showW / ratio);
  if(showH > maxH){ showH = maxH; showW = Math.round(showH * ratio); }
  canvas.style.width = showW + 'px';
  canvas.style.height = showH + 'px';
}
window.addEventListener('resize', fitCanvasToContainer);
fitCanvasToContainer();

/* application state with sample content similar to screenshot */
let state = {
  template: 'ats', // default ATS professional
  theme: '#0b6cff',
  profile: {
    name: 'ENTER YOUR NAME',
    headline: 'Software Engineer',
    linkedin: 'https://linkedin.com/in/karthick',
    email: 'karthick@uofga.edu',
    phone: '**********',
    location: 'location, ',
    summary: 'Experienced in project management focused on corpsofts with extensive troubleshooting. Skilled in team building and management with demonstrated success.'
  },
  education: {
    school: 'University of Georgia, School of Computing',
    degree: 'Bachelor of Science, Computer Science — Emphasis: Software Design',
    years: 'May 2023',
    gpa: 'GPA: 3.84 / 4.00'
  },
  coursework: 'Software Engineering, Mobile Software Development, Simulation & Modeling, Database Management',
  skills: [
    { id: id(), name: 'Programming Languages: C, C++, Java, SQL' },
    { id: id(), name: 'OS: Windows, Linux, Unix' },
    { id: id(), name: 'Database: SQL Server, MS Access, Oracle' },
  ],
  experiences: [
    { id: id(), role: 'Blog Writer', company: 'UGA Computer Science Dept', location:'Athens, GA', years:'Aug 2022 - Present', desc: 'Write and publish 5+ blog posts each month highlighting industry trends; interviewed faculty and external employers.' },
    { id: id(), role: 'Intern', company: 'Financial Network Services Pvt. Ltd.', location:'Remote', years:'June 2021 - Aug 2021', desc: 'Operated Nav systems and coordinated transfers across regions; configured notebooks and assisted 6 overseas consultants.' }
  ],
  projects: 'Athens Area Humane Society — Built a database to track adoptions; developed UI to manage records.',
  additional: 'Member, Pi Kappa Alpha Fraternity; volunteer work and leadership roles.'
};

function id(){ return 'id_' + Math.random().toString(36).slice(2,9); }

/* ---- DOM elements ---- */
const tplBtns = document.querySelectorAll('.tpl');
const themeEl = document.getElementById('theme');
const photoEl = document.getElementById('photo');
const nameEl = document.getElementById('name');
const headlineEl = document.getElementById('headline');
const linkedinEl = document.getElementById('linkedin');
const emailEl = document.getElementById('email');
const phoneEl = document.getElementById('phone');
const locationEl = document.getElementById('location');
const summaryEl = document.getElementById('summary');
const schoolEl = document.getElementById('school');
const degreeEl = document.getElementById('degree');
const eduYearsEl = document.getElementById('eduYears');
const courseworkEl = document.getElementById('coursework');
const skillListEl = document.getElementById('skillList');
const expListEl = document.getElementById('expList');
const projectsEl = document.getElementById('projects');
const additionalEl = document.getElementById('additional');

const addSkillBtn = document.getElementById('addSkill');
const addExpBtn = document.getElementById('addExp');
const addCoBtn = document.getElementById('addCo');

const saveLocalBtn = document.getElementById('saveLocal');
const loadLocalBtn = document.getElementById('loadLocal');
const exportJsonBtn = document.getElementById('exportJson');
const importJsonEl = document.getElementById('importJson');
const resetBtn = document.getElementById('resetBtn');

const downloadPNGBtn = document.getElementById('downloadPNG');
const downloadPDFBtn = document.getElementById('downloadPDF');

/* hydrate UI with state */
function hydrateUI(){
  // template selection
  tplBtns.forEach(b=>{ b.classList.toggle('selected', b.dataset.tpl===state.template); });
  themeEl.value = state.theme;
  nameEl.value = state.profile.name;
  headlineEl.value = state.profile.headline;
  linkedinEl.value = state.profile.linkedin;
  emailEl.value = state.profile.email;
  phoneEl.value = state.profile.phone;
  locationEl.value = state.profile.location;
  summaryEl.value = state.profile.summary;
  schoolEl.value = state.education.school;
  degreeEl.value = state.education.degree;
  eduYearsEl.value = state.education.years;
  courseworkEl.value = state.coursework;
  projectsEl.value = state.projects;
  additionalEl.value = state.additional;
  renderLists();
}
hydrateUI();

/* render skills and experiences lists in form */
function renderLists(){
  skillListEl.innerHTML = '';
  state.skills.forEach(s => {
    const d = document.createElement('div'); d.className='item';
    d.innerHTML = `<div style="display:flex;gap:8px;align-items:center">
      <input data-key="name" class="small" value="${escapeHtml(s.name)}">
      <button class="small" data-act="remove">✕</button></div>`;
    d.querySelector('[data-key]').addEventListener('input', (e)=>{ s.name = e.target.value; requestRender(); });
    d.querySelector('[data-act="remove"]').addEventListener('click', ()=>{ state.skills = state.skills.filter(x=>x.id!==s.id); renderLists(); requestRender(); });
    skillListEl.appendChild(d);
  });

  expListEl.innerHTML = '';
  state.experiences.forEach(exp => {
    const d = document.createElement('div'); d.className='item';
    d.innerHTML = `<div style="display:flex;gap:8px;align-items:center">
      <input data-key="role" class="small" value="${escapeHtml(exp.role)}">
      <input data-key="company" class="small" value="${escapeHtml(exp.company)}">
      <input data-key="years" class="small" style="width:120px" value="${escapeHtml(exp.years)}">
      <button class="small" data-act="remove">✕</button>
    </div>
    <label class="muted">Location</label>
    <input data-key="location" class="small" value="${escapeHtml(exp.location)}">
    <label class="muted">Description</label>
    <textarea data-key="desc">${escapeHtml(exp.desc)}</textarea>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button class="small" data-act="addCo">+ Add Co-Experience</button>
      <button class="small" data-act="removeCo" ${exp.co ? '' : 'disabled'}>${exp.co ? 'Remove Co' : 'No Co'}</button>
    </div>`;
    // wire inputs
    d.querySelectorAll('[data-key]').forEach(inp=>{
      inp.addEventListener('input', ()=> {
        const k = inp.dataset.key;
        if(k==='role') exp.role = inp.value;
        if(k==='company') exp.company = inp.value;
        if(k==='years') exp.years = inp.value;
        if(k==='location') exp.location = inp.value;
        if(k==='desc') exp.desc = inp.value;
        requestRender();
      });
    });
    d.querySelector('[data-act="remove"]').addEventListener('click', ()=>{ state.experiences = state.experiences.filter(x=>x.id!==exp.id); renderLists(); requestRender(); });
    d.querySelector('[data-act="addCo"]').addEventListener('click', ()=>{ if(!exp.co) exp.co = { role:'Co-role', company:'Co-company', years:'2020', desc:'Co description' }; renderLists(); requestRender(); });
    d.querySelector('[data-act="removeCo"]').addEventListener('click', ()=>{ exp.co = null; renderLists(); requestRender(); });
    expListEl.appendChild(d);
    if(exp.co){
      const coDiv = document.createElement('div'); coDiv.className='item'; coDiv.style.marginLeft='12px';
      coDiv.innerHTML = `<div style="font-weight:600">Co-Experience</div>
        <div style="display:flex;gap:8px;align-items:center">
          <input data-key="coRole" class="small" value="${escapeHtml(exp.co.role)}">
          <input data-key="coCompany" class="small" value="${escapeHtml(exp.co.company)}">
          <input data-key="coYears" class="small" style="width:120px" value="${escapeHtml(exp.co.years)}">
        </div>
        <label class="muted">Description</label>
        <textarea data-key="coDesc">${escapeHtml(exp.co.desc)}</textarea>`;
      coDiv.querySelectorAll('[data-key]').forEach(inp=>{
        inp.addEventListener('input', ()=>{
          const k = inp.dataset.key;
          if(k==='coRole') exp.co.role = inp.value;
          if(k==='coCompany') exp.co.company = inp.value;
          if(k==='coYears') exp.co.years = inp.value;
          if(k==='coDesc') exp.co.desc = inp.value;
          requestRender();
        });
      });
      expListEl.appendChild(coDiv);
    }
  });
}

/* add item buttons */
addSkillBtn.addEventListener('click', ()=>{ state.skills.push({ id:id(), name:'New skill' }); renderLists(); requestRender(); });
addExpBtn.addEventListener('click', ()=>{ state.experiences.push({ id:id(), role:'New Role', company:'Company', years:'Year', location:'', desc:'Description' }); renderLists(); requestRender(); });
addCoBtn.addEventListener('click', ()=>{ const last = state.experiences[state.experiences.length-1]; if(last && !last.co) last.co = { role:'Co-role', company:'Co-company', years:'2020', desc:'Co desc' }; renderLists(); requestRender(); });

/* template selector */
tplBtns.forEach(b=>{
  b.addEventListener('click', ()=>{
    tplBtns.forEach(x=>x.classList.remove('selected'));
    b.classList.add('selected');
    state.template = b.dataset.tpl;
    requestRender();
  });
});

/* wire simple inputs to state */
[themeEl, nameEl, headlineEl, linkedinEl, emailEl, phoneEl, locationEl, summaryEl,
 schoolEl, degreeEl, eduYearsEl, courseworkEl, projectsEl, additionalEl].forEach(el=>{
  if(!el) return;
  el.addEventListener('input', ()=>{
    state.theme = themeEl.value;
    state.profile.name = nameEl.value;
    state.profile.headline = headlineEl.value;
    state.profile.linkedin = linkedinEl.value;
    state.profile.email = emailEl.value;
    state.profile.phone = phoneEl.value;
    state.profile.location = locationEl.value;
    state.profile.summary = summaryEl.value;
    state.education.school = schoolEl.value;
    state.education.degree = degreeEl.value;
    state.education.years = eduYearsEl.value;
    state.coursework = courseworkEl.value;
    state.projects = projectsEl.value;
    state.additional = additionalEl.value;
    requestRender();
  });
});

/* photo upload */
photoEl.addEventListener('change', e=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ev=>{
    const img = new Image();
    img.onload = ()=>{ state.profile.photo = img; requestRender(); };
    img.src = ev.target.result;
  };
  r.readAsDataURL(f);
});

/* ---------- drawing to canvas (A4) ---------- */
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); }

/* small text wrapper */
function drawWrappedText(x,y,maxW,lineH, text, font, fillStyle='#111'){
  ctx.font = font;
  ctx.fillStyle = fillStyle;
  ctx.textBaseline = 'top';
  const words = (text||'').split(' ');
  let line = '', yy = y;
  for(let n=0;n<words.length;n++){
    const test = line + words[n] + ' ';
    if(ctx.measureText(test).width > maxW && n>0){
      ctx.fillText(line, x, yy);
      line = words[n] + ' ';
      yy += lineH;
    } else line = test;
  }
  ctx.fillText(line, x, yy);
  return yy + lineH;
}

/* draw ATS template — text-first, left aligned similar to screenshot */
function drawATSTemplate(){
  clearCanvas();
  // white background
  ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
  const margin = Math.round(24 * DPI/96);
  const contentW = canvas.width - margin*2;

  // header: name center top with contact line beneath (screenshot style)
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(28 * DPI/96)}px Inter, sans-serif`;
  const name = state.profile.name || '';
  ctx.textAlign = 'center';
  ctx.fillText(name, canvas.width/2, margin);
  ctx.font = `${Math.round(12 * DPI/96)}px Inter, sans-serif`; ctx.fillStyle = '#333';
  const contactLine = `${state.profile.email || ''} • ${state.profile.phone || ''} • ${state.profile.linkedin || ''}`;
  ctx.fillText(contactLine, canvas.width/2, margin + Math.round(36 * DPI/96));
  ctx.textAlign = 'left';

  // a thin horizontal rule
  ctx.fillStyle = '#e6eef8'; ctx.fillRect(margin, margin + Math.round(56*DPI/96), contentW, 1);

  // left column full width text blocks as in screenshot
  let y = margin + Math.round(70*DPI/96);

  // Summary heading
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(14*DPI/96)}px Inter, sans-serif`; ctx.fillText('SUMMARY OF QUALIFICATIONS', margin, y);
  y += Math.round(18*DPI/96);
  ctx.fillStyle = '#333'; ctx.font = `${Math.round(12*DPI/96)}px Inter, sans-serif`;
  y = drawWrappedText(margin + 8, y, contentW - 16, Math.round(18*DPI/96), state.profile.summary, `${Math.round(12*DPI/96)}px Inter, sans-serif`, '#222');

  // Education
  y += Math.round(10*DPI/96);
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(14*DPI/96)}px Inter, sans-serif`; ctx.fillText('EDUCATION', margin, y);
  y += Math.round(18*DPI/96);
  ctx.fillStyle = '#222'; ctx.font = `${Math.round(12*DPI/96)}px Inter, sans-serif`;
  drawWrappedText(margin + 8, y, contentW - 16, Math.round(16*DPI/96), `${state.education.school} — ${state.education.degree}`, `${Math.round(12*DPI/96)}px Inter, sans-serif`, '#111');
  y += Math.round(30*DPI/96);
  ctx.fillStyle = '#666'; ctx.font = `${Math.round(11*DPI/96)}px Inter, sans-serif`;
  ctx.fillText(state.education.years + (state.education.gpa ? ' • ' + state.education.gpa : ''), margin + 8, y);
  y += Math.round(20*DPI/96);

  // Coursework
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(13*DPI/96)}px Inter, sans-serif`; ctx.fillText('RELEVANT COURSEWORK', margin, y);
  y += Math.round(18*DPI/96);
  ctx.fillStyle = '#333'; ctx.font = `${Math.round(12*DPI/96)}px Inter, sans-serif`;
  y = drawWrappedText(margin + 8, y, contentW - 16, Math.round(16*DPI/96), state.coursework, `${Math.round(12*DPI/96)}px Inter, sans-serif`, '#222');

  // Technical Skills
  y += Math.round(8*DPI/96);
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(13*DPI/96)}px Inter, sans-serif`; ctx.fillText('TECHNICAL SKILLS', margin, y);
  y += Math.round(18*DPI/96);
  ctx.fillStyle = '#333'; ctx.font = `${Math.round(12*DPI/96)}px Inter, sans-serif`;
  state.skills.forEach(s => {
    y = drawWrappedText(margin + 8, y, contentW - 16, Math.round(16*DPI/96), s.name, `${Math.round(12*DPI/96)}px Inter, sans-serif`, '#222');
    y += Math.round(6*DPI/96);
  });

  // Experience
  y += Math.round(6*DPI/96);
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(13*DPI/96)}px Inter, sans-serif`; ctx.fillText('RELEVANT EXPERIENCE', margin, y);
  y += Math.round(18*DPI/96);
  state.experiences.forEach(exp=>{
    ctx.fillStyle = '#111'; ctx.font = `${Math.round(12*DPI/96)}px Inter, sans-serif`;
    ctx.fillText(`${exp.company} — ${exp.role}`, margin + 8, y);
    ctx.fillStyle = '#666'; ctx.font = `${Math.round(11*DPI/96)}px Inter, sans-serif`;
    ctx.fillText(`${exp.location} • ${exp.years}`, canvas.width - margin - 220, y);
    y += Math.round(18*DPI/96);
    ctx.fillStyle = '#222';
    y = drawWrappedText(margin + 16, y, contentW - 32, Math.round(16*DPI/96), exp.desc, `${Math.round(11*DPI/96)}px Inter, sans-serif`, '#222');
    y += Math.round(8*DPI/96);
    if(exp.co){
      ctx.fillStyle = '#111'; ctx.font = `${Math.round(11*DPI/96)}px Inter, sans-serif`; ctx.fillText(`Co: ${exp.co.company} — ${exp.co.role}`, margin + 16, y);
      y += Math.round(16*DPI/96);
      y = drawWrappedText(margin + 20, y, contentW - 40, Math.round(15*DPI/96), exp.co.desc, `${Math.round(11*DPI/96)}px Inter, sans-serif`, '#444');
      y += Math.round(8*DPI/96);
    }
  });

  // Projects / Additional
  y += Math.round(6*DPI/96);
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(13*DPI/96)}px Inter, sans-serif`; ctx.fillText('PROJECTS', margin, y);
  y += Math.round(18*DPI/96);
  ctx.fillStyle = '#222'; y = drawWrappedText(margin + 8, y, contentW - 16, Math.round(16*DPI/96), state.projects, `${Math.round(12*DPI/96)}px Inter, sans-serif`, '#222');

  y += Math.round(8*DPI/96);
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(13*DPI/96)}px Inter, sans-serif`; ctx.fillText('ADDITIONAL EXPERIENCE', margin, y);
  y += Math.round(18*DPI/96);
  ctx.fillStyle = '#222'; drawWrappedText(margin + 8, y, contentW - 16, Math.round(16*DPI/96), state.additional, `${Math.round(12*DPI/96)}px Inter, sans-serif`, '#222');
}

/* alternate templates (nice visual examples). Keep ATS default as asked */
function drawHiTech(){
  clearCanvas();
  // simple neon-ish background and layout (not fully identical to previous hi-tech — quick rendering)
  const g = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  g.addColorStop(0, hexToRgba(state.theme,0.12));
  g.addColorStop(1, '#031018');
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
  // basic content: name, headline, summary, experience columns
  const margin = Math.round(40*DPI/96);
  ctx.fillStyle = '#fff'; ctx.font = `${Math.round(36*DPI/96)}px Inter, sans-serif`; ctx.fillText(state.profile.name, margin, margin + 10);
  ctx.font = `${Math.round(18*DPI/96)}px Inter, sans-serif`; ctx.fillStyle = '#dbeafe'; ctx.fillText(state.profile.headline, margin, margin + 60);
  // right column experiences
  let x = margin, y = margin + 120, w = canvas.width - margin*2;
  state.experiences.forEach(exp=>{
    ctx.fillStyle = 'rgba(255,255,255,0.04)'; drawRoundedRect(x,y,w,Math.round(120*DPI/96),12,'rgba(255,255,255,0.02)');
    ctx.fillStyle = '#fff'; ctx.font = `${Math.round(18*DPI/96)}px Inter, sans-serif`; ctx.fillText(exp.role + ' — ' + exp.company, x + 12, y + 12);
    ctx.fillStyle = '#cfe2ff'; ctx.font = `${Math.round(12*DPI/96)}px Inter, sans-serif`; drawWrappedText(x + 12, y + 40, w - 24, Math.round(16*DPI/96), exp.desc, `${Math.round(12*DPI/96)}px Inter, sans-serif`);
    y += Math.round(140*DPI/96);
  });
}

function drawPortfolio(){
  clearCanvas();
  // big left accent, right content
  ctx.fillStyle = state.theme; ctx.fillRect(0,0,Math.round(canvas.width*0.28),canvas.height);
  ctx.fillStyle = '#fff'; ctx.font = `${Math.round(30*DPI/96)}px Inter, sans-serif`; ctx.fillText(state.profile.name, 40, 60);
  ctx.font = `${Math.round(14*DPI/96)}px Inter, sans-serif`; ctx.fillText(state.profile.headline, 40, 110);
  // right content: projects
  let x = Math.round(canvas.width*0.32), y = 60;
  ctx.fillStyle = '#111'; ctx.font = `${Math.round(20*DPI/96)}px Inter, sans-serif`; ctx.fillText('Projects', x, y);
  y += 30;
  ctx.fillStyle = '#333';
  drawWrappedText(x, y, canvas.width - x - 60, Math.round(16*DPI/96), state.projects, `${Math.round(13*DPI/96)}px Inter, sans-serif`);
}

/* master draw */
function renderCanvas(){
  if(state.template === 'ats') drawATSTemplate();
  else if(state.template === 'hitech') drawHiTech();
  else drawPortfolio();
}

/* ---------- utilities ---------- */
function hexToRgba(hex, a=1){
  const h = hex.replace('#','');
  const bigint = parseInt(h.length===3 ? h.split('').map(c=>c+c).join('') : h, 16);
  const r = (bigint >> 16) & 255, g = (bigint >> 8) & 255, b = bigint & 255;
  return `rgba(${r},${g},${b},${a})`;
}
function drawRoundedRect(x,y,w,h,r,fill){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y); ctx.quadraticCurveTo(x+w,y,x+w,y+r); ctx.lineTo(x+w,y+h-r); ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h); ctx.lineTo(x+r,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-r); ctx.lineTo(x,y+r); ctx.quadraticCurveTo(x,y,x+r,y); ctx.closePath(); if(fill){ ctx.fillStyle = fill; ctx.fill(); } }
function escapeHtml(s){ return String(s||''); }

/* ---------- rendering loop / requestRender ---------- */
let pending = false;
function requestRender(){
  if(pending) return;
  pending = true;
  setTimeout(()=>{ pending = false; renderCanvas(); fitCanvasToContainer(); }, 0);
}
requestRender();

/* ---------- Save/Load JSON (localStorage + download/upload) ---------- */
function saveLocal(){
  try{
    localStorage.setItem('resume-builder-data', JSON.stringify(state));
    alert('Saved locally to browser storage.');
  }catch(e){ alert('Save failed: ' + e.message); }
}
function loadLocal(){
  const raw = localStorage.getItem('resume-builder-data');
  if(!raw){ alert('No local save found.'); return; }
  try{
    state = JSON.parse(raw);
    hydrateUI();
    requestRender();
  }catch(e){ alert('Failed to load saved data'); }
}
function downloadJson(){
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `${(state.profile.name||'resume').replace(/\s+/g,'_')}.json`; a.click(); URL.revokeObjectURL(url);
}
importJsonEl.addEventListener('change', (e)=> {
  const file = e.target.files && e.target.files[0];
  if(!file) return;
  const r = new FileReader();
  r.onload = ev => {
    try{ state = JSON.parse(ev.target.result); hydrateUI(); requestRender(); } catch(err){ alert('Invalid JSON'); }
  };
  r.readAsText(file);
});

/* download PNG and PDF (A4) */
downloadPNGBtn.addEventListener('click', ()=> {
  requestRender();
  setTimeout(()=> {
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `${(state.profile.name||'resume').replace(/\s+/g,'_')}.png`; a.click(); URL.revokeObjectURL(url);
    }, 'image/png');
  }, 150);
});

downloadPDFBtn.addEventListener('click', async ()=> {
  requestRender();
  setTimeout(async ()=> {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit: 'mm', format: 'a4' });
    // Add as JPEG (smaller)
    const dataUrl = canvas.toDataURL('image/jpeg', 0.95);
    pdf.addImage(dataUrl, 'JPEG', 0, 0, A4_MM_W, A4_MM_H);
    pdf.save(`${(state.profile.name||'resume').replace(/\s+/g,'_')}.pdf`);
  }, 220);
});

/* wire other UI buttons */
saveLocalBtn.addEventListener('click', saveLocal);
loadLocalBtn.addEventListener('click', loadLocal);
exportJsonBtn.addEventListener('click', downloadJson);
document.getElementById('importJson').addEventListener('change', (e)=>{ /* handled above */ });
resetBtn.addEventListener('click', ()=>{ if(confirm('Reset to sample content?')) { location.reload(); } });

/* small helper: keep state in sync when lists updated from UI */
function collectFormState(){
  state.theme = themeEl.value;
  state.profile.name = nameEl.value;
  state.profile.headline = headlineEl.value;
  state.profile.linkedin = linkedinEl.value;
  state.profile.email = emailEl.value;
  state.profile.phone = phoneEl.value;
  state.profile.location = locationEl.value;
  state.profile.summary = summaryEl.value;
  state.education.school = schoolEl.value;
  state.education.degree = degreeEl.value;
  state.education.years = eduYearsEl.value;
  state.coursework = courseworkEl.value;
  state.projects = projectsEl.value;
  state.additional = additionalEl.value;
}
/* Monitor input changes for state sync */
document.querySelectorAll('input,textarea,select').forEach(el=>{
  el.addEventListener('input', ()=>{ collectFormState(); requestRender(); });
});

/* initial render and fit */
hydrateUI();
requestRender();
fitCanvasToContainer();



</script>
</body>
</html>
